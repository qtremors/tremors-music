[{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\AddToPlaylistModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\ConfirmDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\ContextMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\CreatePlaylistModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\FullScreenPlayer.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nZ:\\Antigravity\\tremors-music\\frontend\\src\\components\\FullScreenPlayer.tsx:36:7\n  34 |     // Always check/fetch to ensure fresh state, but avoid redundant network calls if we already have it\n  35 |     if (lastSongIdRef.current !== currentSong.id) {\n> 36 |       setLyrics(null);\n     |       ^^^^^^^^^ Avoid calling setState() directly within an effect\n  37 |       setAlbumName(null);\n  38 |       lastSongIdRef.current = currentSong.id;\n  39 |     } else if (lyrics) {","line":36,"column":7,"nodeType":null,"endLine":36,"endColumn":16},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'currentSong' and 'lyrics'. Either include them or remove the dependency array.","line":74,"column":6,"nodeType":"ArrayExpression","endLine":74,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [currentSong, currentSong.id, lyrics]","fix":{"range":[2720,2737],"text":"[currentSong, currentSong.id, lyrics]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { usePlayerStore } from '../stores/playerStore';\r\nimport { getCoverUrl, getLyrics, getAlbum } from '../lib/api';\r\nimport { cn, formatTime } from '../lib/utils';\r\nimport { ChevronDown, Play, Pause, SkipBack, SkipForward, MessageSquare, Volume2, Repeat, Shuffle, Repeat1 } from 'lucide-react';\r\nimport { AnimatePresence, motion } from 'framer-motion';\r\nimport { SyncedLyrics } from './player/SyncedLyrics';\r\n\r\ninterface FullScreenPlayerProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport function FullScreenPlayer({ isOpen, onClose }: FullScreenPlayerProps) {\r\n  const navigate = useNavigate();\r\n  const {\r\n    currentSong, isPlaying, togglePlay, playNext, playPrev,\r\n    volume, setVolume, repeatMode, toggleRepeat, isShuffle, toggleShuffle\r\n  } = usePlayerStore();\r\n\r\n  const [lyrics, setLyrics] = useState<{ plainLyrics?: string, syncedLyrics?: string } | null>(null);\r\n  const [albumName, setAlbumName] = useState<string | null>(null);\r\n  const [showLyrics, setShowLyrics] = useState(false);\r\n  const [currentTime, setCurrentTime] = useState(0);\r\n  const [duration, setDuration] = useState(0);\r\n  const lastSongIdRef = useRef<number | null>(null);\r\n\r\n  // Only fetch lyrics & album info when song changes\r\n  useEffect(() => {\r\n    if (!currentSong) return;\r\n\r\n    // 1. Fetch Lyrics\r\n    // Always check/fetch to ensure fresh state, but avoid redundant network calls if we already have it\r\n    if (lastSongIdRef.current !== currentSong.id) {\r\n      setLyrics(null);\r\n      setAlbumName(null);\r\n      lastSongIdRef.current = currentSong.id;\r\n    } else if (lyrics) {\r\n      // If we already have lyrics, we might still need album name?\r\n      // Let's just proceed to checking album name.\r\n    }\r\n\r\n    let isMounted = true;\r\n\r\n    // Clear previous lyrics immediately to show loading state if changing songs\r\n    if (!lyrics && lastSongIdRef.current !== currentSong.id) setLyrics(null);\r\n\r\n    // Fetch Lyrics\r\n    getLyrics(currentSong.id)\r\n      .then(data => {\r\n        if (isMounted) setLyrics(data);\r\n      })\r\n      .catch(() => {\r\n        if (isMounted) setLyrics(null);\r\n      });\r\n\r\n    // 2. Fetch Album Name (if missing from song object)\r\n    if (currentSong.album?.title) {\r\n      setAlbumName(currentSong.album.title);\r\n    } else if (currentSong.album_id) {\r\n      getAlbum(currentSong.album_id)\r\n        .then(album => {\r\n          if (isMounted && album && album.title) {\r\n            setAlbumName(album.title);\r\n          }\r\n        })\r\n        .catch(() => {\r\n          // Album fetch failed - non-critical\r\n        });\r\n    }\r\n\r\n    return () => { isMounted = false; };\r\n  }, [currentSong?.id]);\r\n\r\n  useEffect(() => {\r\n    let interval: number;\r\n    if (isOpen) {\r\n      // Use window.setInterval instead of NodeJS\r\n      interval = window.setInterval(() => {\r\n        const audio = document.querySelector('audio');\r\n        if (audio) {\r\n          // Only update if changed significantly to reduce renders? \r\n          // Actually 100ms is fine, but let's ensure we don't leak\r\n          setCurrentTime(audio.currentTime);\r\n          setDuration(audio.duration || 0);\r\n        }\r\n      }, 100);\r\n    }\r\n    return () => clearInterval(interval);\r\n  }, [isOpen]);\r\n\r\n  const handleSeek = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const val = Number(e.target.value);\r\n    const audio = document.querySelector('audio');\r\n    if (audio) {\r\n      audio.currentTime = val;\r\n      setCurrentTime(val);\r\n    }\r\n  };\r\n\r\n  if (!currentSong) return null;\r\n\r\n  const lyricsContent = lyrics?.syncedLyrics || lyrics?.plainLyrics;\r\n  const hasSyncedLyrics = !!lyrics?.syncedLyrics;\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <motion.div\r\n          initial={{ y: '100%' }}\r\n          animate={{ y: 0 }}\r\n          exit={{ y: '100%' }}\r\n          transition={{ type: 'spring', damping: 25, stiffness: 200 }}\r\n          className=\"fixed inset-0 z-[100] bg-[#1c1c1e] text-white flex flex-col overflow-hidden\"\r\n        >\r\n          {/* --- Background --- */}\r\n          <div className=\"absolute inset-0 bg-cover bg-center opacity-30 blur-[100px] scale-125 pointer-events-none transform-gpu\"\r\n            style={{ backgroundImage: currentSong.album_id ? `url(${getCoverUrl(currentSong.album_id, 'small')})` : undefined }}\r\n          />\r\n          <div className=\"absolute inset-0 bg-black/40\" />\r\n\r\n          {/* --- Header --- */}\r\n          <div className=\"relative z-20 flex justify-between items-center px-8 py-6 flex-shrink-0\">\r\n            <button onClick={onClose} className=\"p-2 bg-white/10 rounded-full hover:bg-white/20\"><ChevronDown size={20} /></button>\r\n            <div className=\"w-10\" />\r\n          </div>\r\n\r\n          {/* --- Main Content --- */}\r\n          <div className=\"relative z-10 flex-1 min-h-0 w-full max-w-screen-2xl mx-auto px-8 pb-8 flex gap-12 items-center\">\r\n\r\n            {/* LEFT COLUMN: Art & Controls */}\r\n            <div className={cn(\r\n              \"flex flex-col justify-center h-full transition-all duration-500 ease-in-out mx-auto\",\r\n              showLyrics ? \"w-1/2 max-w-xl\" : \"w-full max-w-lg\"\r\n            )}>\r\n\r\n              {/* Flexible Art Container */}\r\n              <div className=\"flex-1 min-h-0 flex items-center justify-center mb-6 w-full\">\r\n                <div className=\"aspect-square h-full max-h-[50vh] w-auto rounded-xl shadow-2xl overflow-hidden border border-white/10 bg-gray-800 relative flex-shrink-0\">\r\n                  {currentSong.album_id && <img src={getCoverUrl(currentSong.album_id, 'full')} className=\"w-full h-full object-cover\" />}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Metadata & Controls */}\r\n              <div className=\"flex-shrink-0 space-y-6 w-full\">\r\n                <div className={showLyrics ? \"text-left\" : \"text-center\"}>\r\n                  <h2 className=\"text-3xl font-bold truncate leading-tight mb-2 text-white drop-shadow-md\">\r\n                    {currentSong.title}\r\n                  </h2>\r\n\r\n                  <div className=\"space-y-1\">\r\n                    <p\r\n                      className=\"text-xl text-apple-accent truncate font-medium cursor-pointer transition-all opacity-90 hover:opacity-100\"\r\n                      onClick={() => {\r\n                        onClose();\r\n                        navigate(`/artists/${encodeURIComponent(currentSong.artist)}`);\r\n                      }}\r\n                    >\r\n                      {currentSong.artist}\r\n                    </p>\r\n                    {currentSong.album_id && (albumName || currentSong.album?.title) && (\r\n                      <p\r\n                        className=\"text-lg text-white/50 truncate cursor-pointer hover:text-white transition-all\"\r\n                        onClick={() => {\r\n                          onClose();\r\n                          navigate(`/albums/${currentSong.album_id}`);\r\n                        }}\r\n                      >\r\n                        {albumName || currentSong.album?.title}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* TECH BADGES */}\r\n                  <div className={cn(\"flex gap-2 mt-4 opacity-60\", showLyrics ? \"justify-start\" : \"justify-center\")}>\r\n                    <span className=\"px-1.5 py-0.5 rounded border border-white/30 text-[9px] font-bold uppercase tracking-widest text-white/80\">\r\n                      {currentSong.format?.toUpperCase() || 'MP3'}\r\n                    </span>\r\n                    {currentSong.bitrate && (\r\n                      <span className=\"px-1.5 py-0.5 rounded border border-white/30 text-[9px] font-bold uppercase tracking-widest text-white/80\">\r\n                        {currentSong.bitrate} kbps\r\n                      </span>\r\n                    )}\r\n                    {currentSong.sample_rate && (\r\n                      <span className=\"px-1.5 py-0.5 rounded border border-white/30 text-[9px] font-bold uppercase tracking-widest text-white/80\">\r\n                        {(currentSong.sample_rate / 1000).toFixed(1)} kHz\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Progress */}\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"relative w-full h-1 bg-white/20 rounded-full group cursor-pointer\">\r\n                    <div\r\n                      className=\"absolute top-0 left-0 h-full w-full bg-white rounded-full origin-left will-change-transform\"\r\n                      style={{ transform: `scaleX(${duration ? currentTime / duration : 0})` }}\r\n                    />\r\n                    <input\r\n                      type=\"range\" min={0} max={duration || 100} value={currentTime}\r\n                      onChange={handleSeek}\r\n                      className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\"\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex justify-between text-xs font-medium text-white/50\">\r\n                    <span>{formatTime(currentTime)}</span>\r\n                    <span>{formatTime(duration)}</span>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Controls */}\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2 w-24\">\r\n                    <Volume2 size={16} className=\"text-white/60\" />\r\n                    <input\r\n                      type=\"range\" min={0} max={1} step={0.01} value={volume}\r\n                      onChange={e => setVolume(parseFloat(e.target.value))}\r\n                      className=\"w-16 h-1 bg-white/20 rounded-lg appearance-none cursor-pointer accent-white\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center gap-8\">\r\n                    <button onClick={playPrev} className=\"hover:text-white/80 transition hover:scale-105\"><SkipBack size={28} fill=\"currentColor\" /></button>\r\n                    <button onClick={togglePlay} className=\"hover:scale-105 transition\">\r\n                      {isPlaying ? <Pause size={48} fill=\"currentColor\" /> : <Play size={48} fill=\"currentColor\" />}\r\n                    </button>\r\n                    <button onClick={playNext} className=\"hover:text-white/80 transition hover:scale-105\"><SkipForward size={28} fill=\"currentColor\" /></button>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center gap-3 w-24 justify-end\">\r\n                    <button onClick={toggleShuffle} className={cn(\"transition\", isShuffle ? \"text-apple-accent\" : \"text-white/40 hover:text-white\")}>\r\n                      <Shuffle size={18} />\r\n                    </button>\r\n                    <button onClick={toggleRepeat} className={cn(\"transition relative\", repeatMode !== 'off' ? \"text-apple-accent\" : \"text-white/40 hover:text-white\")}>\r\n                      {repeatMode === 'one' ? <Repeat1 size={18} /> : <Repeat size={18} />}\r\n                      {repeatMode !== 'off' && <div className=\"absolute -bottom-2 left-1/2 -translate-x-1/2 w-0.5 h-0.5 bg-current rounded-full\" />}\r\n                    </button>\r\n                    <button\r\n                      onClick={() => setShowLyrics(!showLyrics)}\r\n                      className={cn(\"transition p-1.5 rounded-md\", showLyrics ? \"bg-white/20 text-white\" : \"text-white/40 hover:text-white\")}\r\n                    >\r\n                      <MessageSquare size={18} fill={showLyrics ? \"currentColor\" : \"none\"} />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* RIGHT COLUMN: Lyrics */}\r\n            {showLyrics && (\r\n              <div className=\"hidden md:flex flex-col w-1/2 h-full animate-in fade-in slide-in-from-right-10 duration-300\">\r\n                <div className=\"flex items-center justify-between mb-6 flex-shrink-0\">\r\n                  <h3 className=\"text-xs font-bold text-white/40 uppercase tracking-widest\">Lyrics</h3>\r\n                  {hasSyncedLyrics && (\r\n                    <span className=\"text-xs text-apple-accent font-semibold uppercase tracking-wider\">Synced</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"flex-1 overflow-hidden\">\r\n                  {lyricsContent ? (\r\n                    hasSyncedLyrics ? (\r\n                      <SyncedLyrics\r\n                        lyrics={lyricsContent}\r\n                        currentTime={currentTime}\r\n                        className=\"h-full\"\r\n                      />\r\n                    ) : (\r\n                      <div className=\"h-full overflow-y-auto no-scrollbar\">\r\n                        <div className=\"whitespace-pre-wrap text-2xl font-bold text-white/80 leading-relaxed space-y-8 pb-20\">\r\n                          {lyricsContent}\r\n                        </div>\r\n                      </div>\r\n                    )\r\n                  ) : (\r\n                    <div className=\"flex flex-col items-center justify-center h-full text-white/30 space-y-4\">\r\n                      <span className=\"italic text-xl font-medium\">\r\n                        {lyrics === null ? \"Searching for lyrics...\" : \"No lyrics available\"}\r\n                      </span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n\r\n\r\n          </div>\r\n        </motion.div>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\PageWrapper.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\Player.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\SettingsModal.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nZ:\\Antigravity\\tremors-music\\frontend\\src\\components\\SettingsModal.tsx:28:5\n  26 |\n  27 |   useEffect(() => {\n> 28 |     loadPaths();\n     |     ^^^^^^^^^ Avoid calling setState() directly within an effect\n  29 |   }, [loadPaths]);\n  30 |\n  31 |   const handleAddPath = async () => {","line":28,"column":5,"nodeType":null,"endLine":28,"endColumn":14}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { X, Plus, Trash2, RefreshCw, Moon, Sun } from 'lucide-react';\r\nimport api from '../lib/api';\r\nimport { useThemeStore } from '../stores/themeStore';\r\n\r\ninterface SettingsModalProps {\r\n  onClose: () => void;\r\n}\r\n\r\ninterface LibraryPath {\r\n  id: number;\r\n  path: string;\r\n}\r\n\r\nexport function SettingsModal({ onClose }: SettingsModalProps) {\r\n  const [paths, setPaths] = useState<LibraryPath[]>([]);\r\n  const [newPath, setNewPath] = useState('');\r\n  const [isScanning, setIsScanning] = useState(false);\r\n\r\n  const { theme, setTheme, accentColor, setAccentColor } = useThemeStore();\r\n\r\n  const loadPaths = useCallback(async () => {\r\n    const res = await api.get<LibraryPath[]>('/library/paths');\r\n    setPaths(Array.isArray(res.data) ? res.data : []);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadPaths();\r\n  }, [loadPaths]);\r\n\r\n  const handleAddPath = async () => {\r\n    if (!newPath) return;\r\n    try {\r\n      await api.post('/library/paths', { path: newPath });\r\n      setNewPath('');\r\n      loadPaths();\r\n    } catch {\r\n      alert('Invalid path or server error');\r\n    }\r\n  };\r\n\r\n  const handleRemovePath = async (id: number) => {\r\n    await api.delete(`/library/paths/${id}`);\r\n    loadPaths();\r\n  };\r\n\r\n  const handleRescan = async () => {\r\n    setIsScanning(true);\r\n    await api.post('/library/scan');\r\n    setTimeout(() => setIsScanning(false), 2000);\r\n  };\r\n\r\n  // Colors for the picker (RGB values)\r\n  const colors = [\r\n    { name: 'Red', val: '250 45 72' },\r\n    { name: 'Blue', val: '0 122 255' },\r\n    { name: 'Purple', val: '175 82 222' },\r\n    { name: 'Orange', val: '255 149 0' },\r\n    { name: 'Teal', val: '48 176 199' },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm\">\r\n      <div className=\"glass-panel w-full max-w-md p-6 relative animate-in fade-in zoom-in duration-200\">\r\n        <button onClick={onClose} className=\"absolute top-4 right-4 text-apple-subtext hover:text-apple-text\">\r\n          <X size={20} />\r\n        </button>\r\n\r\n        <h2 className=\"text-xl font-bold mb-6 text-apple-text\">Settings</h2>\r\n\r\n        {/* --- Appearance Section --- */}\r\n        <div className=\"mb-8\">\r\n          <h3 className=\"text-sm font-semibold text-apple-subtext uppercase mb-3\">Appearance</h3>\r\n\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <span className=\"text-apple-text\">Theme</span>\r\n            <div className=\"bg-gray-200 dark:bg-gray-700 rounded-full p-1 flex gap-1\">\r\n              <button\r\n                onClick={() => setTheme('light')}\r\n                className={`p-2 rounded-full transition ${theme === 'light' ? 'bg-white shadow-sm' : 'text-gray-500'}`}\r\n              >\r\n                <Sun size={16} />\r\n              </button>\r\n              <button\r\n                onClick={() => setTheme('dark')}\r\n                className={`p-2 rounded-full transition ${theme === 'dark' ? 'bg-gray-600 text-white shadow-sm' : 'text-gray-500'}`}\r\n              >\r\n                <Moon size={16} />\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex gap-3\">\r\n            {colors.map((c) => (\r\n              <button\r\n                key={c.name}\r\n                onClick={() => setAccentColor(c.val)}\r\n                className={`w-8 h-8 rounded-full border-2 transition ${accentColor === c.val ? 'border-gray-400 scale-110' : 'border-transparent'}`}\r\n                style={{ backgroundColor: `rgb(${c.val})` }}\r\n              />\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* --- Library Section --- */}\r\n        <div>\r\n          <h3 className=\"text-sm font-semibold text-apple-subtext uppercase mb-3\">Library Paths</h3>\r\n\r\n          <div className=\"space-y-2 mb-4 max-h-40 overflow-y-auto\">\r\n            {paths.map(p => (\r\n              <div key={p.id} className=\"flex items-center justify-between bg-gray-100 dark:bg-gray-800 p-3 rounded-lg\">\r\n                <span className=\"text-xs font-mono truncate max-w-[200px] text-apple-text\">{p.path}</span>\r\n                <button onClick={() => handleRemovePath(p.id)} className=\"text-red-500 hover:bg-red-100 p-1 rounded\">\r\n                  <Trash2 size={16} />\r\n                </button>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"flex gap-2 mb-6\">\r\n            <input\r\n              type=\"text\"\r\n              value={newPath}\r\n              onChange={(e) => setNewPath(e.target.value)}\r\n              placeholder=\"Paste folder path...\"\r\n              className=\"flex-1 p-2 text-sm rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-apple-text focus:outline-none focus:ring-2 focus:ring-apple-accent\"\r\n            />\r\n            <button onClick={handleAddPath} className=\"p-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300\">\r\n              <Plus size={20} className=\"text-apple-text\" />\r\n            </button>\r\n          </div>\r\n\r\n          <button\r\n            onClick={handleRescan}\r\n            disabled={isScanning}\r\n            className=\"w-full py-3 bg-apple-accent text-white rounded-lg font-medium flex items-center justify-center gap-2 hover:opacity-90 transition\"\r\n          >\r\n            <RefreshCw size={18} className={isScanning ? \"animate-spin\" : \"\"} />\r\n            {isScanning ? 'Scanning...' : 'Rescan Library'}\r\n          </button>\r\n        </div>\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\Sidebar.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nZ:\\Antigravity\\tremors-music\\frontend\\src\\components\\Sidebar.tsx:31:13\n  29 |     useEffect(() => {\n  30 |         if (location.pathname !== '/search') {\n> 31 |             setSearch('');\n     |             ^^^^^^^^^ Avoid calling setState() directly within an effect\n  32 |         }\n  33 |     }, [location.pathname]);\n  34 |","line":31,"column":13,"nodeType":null,"endLine":31,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { NavLink, useNavigate, useLocation } from 'react-router-dom';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { getPlaylists } from '../lib/api';\r\nimport { cn } from '../lib/utils';\r\nimport {\r\n    Library, Settings, Disc, Mic2, Music, Tag,\r\n    PlusCircle, ListMusic, Search, Heart, Sparkles, TrendingUp\r\n} from 'lucide-react';\r\n\r\nexport function Sidebar({ setIsCreatingPlaylist }: { setIsCreatingPlaylist: (val: boolean) => void }) {\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n    const [search, setSearch] = useState('');\r\n\r\n    const { data: playlists } = useQuery({ queryKey: ['playlists'], queryFn: getPlaylists });\r\n\r\n    useEffect(() => {\r\n        const timer = setTimeout(() => {\r\n            if (search.trim()) {\r\n                navigate(`/search?q=${encodeURIComponent(search)}`);\r\n            } else if (location.pathname === '/search' && !search.trim()) {\r\n                navigate('/');\r\n            }\r\n        }, 300);\r\n        return () => clearTimeout(timer);\r\n    }, [search, navigate, location.pathname]);\r\n\r\n    useEffect(() => {\r\n        if (location.pathname !== '/search') {\r\n            setSearch('');\r\n        }\r\n    }, [location.pathname]);\r\n\r\n    return (\r\n        <div className=\"fixed top-0 left-0 w-64 h-full pb-28 bg-gray-50/80 dark:bg-black/50 border-r border-gray-200 dark:border-white/10 hidden lg:flex flex-col p-6 z-20 backdrop-blur-xl\">\r\n\r\n            <div className=\"mb-6 px-2 flex-shrink-0\">\r\n                <h1 className=\"text-2xl font-bold text-apple-accent flex items-center gap-2 mb-6 select-none\">\r\n                    <Library /> Tremors\r\n                </h1>\r\n\r\n                <div className=\"relative group\">\r\n                    <Search size={16} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-apple-subtext group-focus-within:text-apple-text transition-colors\" />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search Library\"\r\n                        value={search}\r\n                        onChange={(e) => setSearch(e.target.value)}\r\n                        className=\"w-full bg-gray-200 dark:bg-white/10 rounded-lg pl-9 pr-3 py-2 text-sm text-apple-text outline-none focus:ring-2 focus:ring-apple-accent/50 transition-all placeholder:text-apple-subtext\"\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            <nav className=\"space-y-1 flex-shrink-0\">\r\n                <NavLink to=\"/\" className={({ isActive }) => cn(\"w-full text-left px-3 py-2 rounded-md font-medium flex items-center gap-3 transition\", isActive ? \"bg-gray-200 dark:bg-white/10 text-apple-text\" : \"text-apple-subtext hover:text-apple-text hover:bg-white/5\")}>\r\n                    <Music size={18} /> Songs\r\n                </NavLink>\r\n                <NavLink to=\"/albums\" className={({ isActive }) => cn(\"w-full text-left px-3 py-2 rounded-md font-medium flex items-center gap-3 transition\", isActive ? \"bg-gray-200 dark:bg-white/10 text-apple-text\" : \"text-apple-subtext hover:text-apple-text hover:bg-white/5\")}>\r\n                    <Disc size={18} /> Albums\r\n                </NavLink>\r\n                <NavLink to=\"/artists\" className={({ isActive }) => cn(\"w-full text-left px-3 py-2 rounded-md font-medium flex items-center gap-3 transition\", isActive ? \"bg-gray-200 dark:bg-white/10 text-apple-text\" : \"text-apple-subtext hover:text-apple-text hover:bg-white/5\")}>\r\n                    <Mic2 size={18} /> Artists\r\n                </NavLink>\r\n                <NavLink to=\"/genres\" className={({ isActive }) => cn(\"w-full text-left px-3 py-2 rounded-md font-medium flex items-center gap-3 transition\", isActive ? \"bg-gray-200 dark:bg-white/10 text-apple-text\" : \"text-apple-subtext hover:text-apple-text hover:bg-white/5\")}>\r\n                    <Tag size={18} /> Genres\r\n                </NavLink>\r\n            </nav>\r\n\r\n            <div className=\"mt-6 mb-2 px-3 flex items-center justify-between group flex-shrink-0\">\r\n                <NavLink to=\"/playlists\" className={({ isActive }) => cn(\"text-xs font-bold uppercase tracking-wider flex-1 transition\", isActive ? \"text-apple-accent\" : \"text-apple-subtext hover:text-apple-text\")}>\r\n                    Playlists\r\n                </NavLink>\r\n                <button\r\n                    onClick={() => setIsCreatingPlaylist(true)}\r\n                    className=\"hover:text-apple-accent text-apple-subtext transition p-1 rounded hover:bg-black/5 dark:hover:bg-white/10\"\r\n                    title=\"Create Playlist\"\r\n                >\r\n                    <PlusCircle size={16} />\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"space-y-1 overflow-y-auto flex-1 min-h-0 no-scrollbar -mx-2 px-2\">\r\n                {/* Smart Playlists */}\r\n                <NavLink to=\"/smart/favorites\" className={({ isActive }) => cn(\"w-full text-left px-3 py-2 rounded-md font-medium flex items-center gap-3 transition text-sm\", isActive ? \"bg-gray-200 dark:bg-white/10 text-apple-text\" : \"text-apple-subtext hover:text-apple-text hover:bg-white/5\")}>\r\n                    <Heart size={16} className=\"text-pink-500 flex-shrink-0\" /> Favorites\r\n                </NavLink>\r\n                <NavLink to=\"/smart/recently-added\" className={({ isActive }) => cn(\"w-full text-left px-3 py-2 rounded-md font-medium flex items-center gap-3 transition text-sm\", isActive ? \"bg-gray-200 dark:bg-white/10 text-apple-text\" : \"text-apple-subtext hover:text-apple-text hover:bg-white/5\")}>\r\n                    <Sparkles size={16} className=\"text-green-500 flex-shrink-0\" /> Recently Added\r\n                </NavLink>\r\n                <NavLink to=\"/smart/most-played\" className={({ isActive }) => cn(\"w-full text-left px-3 py-2 rounded-md font-medium flex items-center gap-3 transition text-sm\", isActive ? \"bg-gray-200 dark:bg-white/10 text-apple-text\" : \"text-apple-subtext hover:text-apple-text hover:bg-white/5\")}>\r\n                    <TrendingUp size={16} className=\"text-purple-500 flex-shrink-0\" /> Most Played\r\n                </NavLink>\r\n\r\n                {/* Divider if there are user playlists */}\r\n                {playlists && playlists.length > 0 && (\r\n                    <div className=\"my-2 border-t border-gray-200 dark:border-white/10\" />\r\n                )}\r\n\r\n                {/* User Playlists */}\r\n                {playlists?.map(pl => (\r\n                    <NavLink\r\n                        key={pl.id}\r\n                        to={`/playlists/${pl.id}`}\r\n                        className={({ isActive }) => cn(\r\n                            \"w-full text-left px-3 py-2 rounded-md font-medium flex items-center gap-3 transition truncate text-sm\",\r\n                            isActive ? \"bg-gray-200 dark:bg-white/10 text-apple-text\" : \"text-apple-subtext hover:text-apple-text hover:bg-white/5\"\r\n                        )}\r\n                    >\r\n                        <ListMusic size={16} className=\"flex-shrink-0\" />\r\n                        <span className=\"truncate\">{pl.name}</span>\r\n                    </NavLink>\r\n                ))}\r\n                {(!playlists || playlists.length === 0) && (\r\n                    <div className=\"px-3 py-2 text-xs text-apple-subtext text-center italic\">\r\n                        No custom playlists yet\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"mt-4 pt-4 border-t border-gray-200 dark:border-white/5 flex-shrink-0\">\r\n                <NavLink to=\"/settings\" className={({ isActive }) => cn(\"flex items-center gap-2 text-sm font-medium transition p-3 rounded-lg w-full\", isActive ? \"bg-apple-accent/10 text-apple-accent\" : \"text-apple-subtext hover:text-apple-text hover:bg-black/5 dark:hover:bg-white/5\")}>\r\n                    <Settings size={18} /> Settings\r\n                </NavLink>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\Skeletons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\SongList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\ToastContainer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\common\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\common\\Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\common\\IconButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\player\\QueuePanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\player\\SyncedLyrics.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nZ:\\Antigravity\\tremors-music\\frontend\\src\\components\\player\\SyncedLyrics.tsx:55:9\n  53 |     // Reset index when song (lyrics) changes\n  54 |     useEffect(() => {\n> 55 |         setCurrentLineIndex(-1);\n     |         ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  56 |     }, [lyrics]);\n  57 |\n  58 |     // Calculate active index logic (Same efficient search as before)","line":55,"column":9,"nodeType":null,"endLine":55,"endColumn":28},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nZ:\\Antigravity\\tremors-music\\frontend\\src\\components\\player\\SyncedLyrics.tsx:90:13\n  88 |\n  89 |         if (nextIndex !== currentLineIndex) {\n> 90 |             setCurrentLineIndex(nextIndex);\n     |             ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  91 |\n  92 |             // Sync scroll with virtualization\n  93 |             if (nextIndex !== -1 && virtuosoRef.current) {","line":90,"column":13,"nodeType":null,"endLine":90,"endColumn":32}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Synced lyrics component with virtualization for minimal RAM usage\r\nimport { useEffect, useRef, useState, useMemo } from 'react';\r\nimport { Virtuoso, VirtuosoHandle } from 'react-virtuoso';\r\nimport { cn } from '../../lib/utils';\r\n\r\ninterface LyricLine {\r\n    time: number;\r\n    text: string;\r\n}\r\n\r\ninterface SyncedLyricsProps {\r\n    lyrics: string;\r\n    currentTime: number;\r\n    className?: string;\r\n}\r\n\r\n// Parse LRC format lyrics\r\nfunction parseLRC(lrc: string): LyricLine[] {\r\n    const lines: LyricLine[] = [];\r\n    const lrcLines = lrc.split('\\n');\r\n\r\n    for (const line of lrcLines) {\r\n        // Match [mm:ss.xx] or [mm:ss] format\r\n        const match = line.match(/\\[(\\d{2}):(\\d{2})(?:\\.(\\d{2,3}))?\\](.*)/);\r\n        if (match) {\r\n            const minutes = parseInt(match[1]);\r\n            const seconds = parseInt(match[2]);\r\n            const milliseconds = match[3] ? parseInt(match[3].padEnd(3, '0')) : 0;\r\n            const text = match[4].trim();\r\n\r\n            const time = minutes * 60 + seconds + milliseconds / 1000;\r\n            lines.push({ time, text });\r\n        }\r\n    }\r\n\r\n    return lines.sort((a, b) => a.time - b.time);\r\n}\r\n\r\nexport function SyncedLyrics({ lyrics, currentTime, className }: SyncedLyricsProps) {\r\n    const [currentLineIndex, setCurrentLineIndex] = useState(-1);\r\n    const [isReady, setIsReady] = useState(false);\r\n    const virtuosoRef = useRef<VirtuosoHandle>(null);\r\n\r\n    // Delay rendering slightly to allow parent container height to settle (fixes \"bugged\" first load)\r\n    useEffect(() => {\r\n        const timer = setTimeout(() => setIsReady(true), 100);\r\n        return () => clearTimeout(timer);\r\n    }, []);\r\n\r\n    // Memoize parsing so it only runs when raw lyrics change\r\n    const parsedLines = useMemo(() => parseLRC(lyrics), [lyrics]);\r\n\r\n    // Reset index when song (lyrics) changes\r\n    useEffect(() => {\r\n        setCurrentLineIndex(-1);\r\n    }, [lyrics]);\r\n\r\n    // Calculate active index logic (Same efficient search as before)\r\n    useEffect(() => {\r\n        if (parsedLines.length === 0) return;\r\n\r\n        // Add 0.3s offset for better sync feel\r\n        const adjustedTime = currentTime + 0.3;\r\n\r\n        // Efficient search strategy\r\n        let nextIndex = -1;\r\n\r\n        const nextPossible = currentLineIndex + 1;\r\n        if (nextPossible < parsedLines.length && parsedLines[nextPossible].time <= adjustedTime) {\r\n            for (let i = nextPossible; i < parsedLines.length; i++) {\r\n                if (parsedLines[i].time <= adjustedTime) {\r\n                    nextIndex = i;\r\n                } else {\r\n                    break;\r\n                }\r\n            }\r\n        } else if (currentLineIndex >= 0 && parsedLines[currentLineIndex].time <= adjustedTime) {\r\n            nextIndex = currentLineIndex;\r\n        } else {\r\n            for (let i = 0; i < parsedLines.length; i++) {\r\n                if (parsedLines[i].time <= adjustedTime) {\r\n                    nextIndex = i;\r\n                } else {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (nextIndex !== currentLineIndex) {\r\n            setCurrentLineIndex(nextIndex);\r\n\r\n            // Sync scroll with virtualization\r\n            if (nextIndex !== -1 && virtuosoRef.current) {\r\n                virtuosoRef.current.scrollToIndex({\r\n                    index: nextIndex,\r\n                    align: 'center',\r\n                    behavior: 'smooth'\r\n                });\r\n            }\r\n        }\r\n    }, [currentTime, parsedLines, currentLineIndex]);\r\n\r\n    if (parsedLines.length === 0) {\r\n        return (\r\n            <div className={cn(\"whitespace-pre-wrap text-2xl font-bold text-white/80 leading-relaxed space-y-8 pb-20 px-4\", className)}>\r\n                {lyrics}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div\r\n            className={cn(\"h-full\", className)}\r\n            style={{\r\n                maskImage: 'linear-gradient(to bottom, transparent 0%, black 10%, black 90%, transparent 100%)',\r\n                WebkitMaskImage: 'linear-gradient(to bottom, transparent 0%, black 10%, black 90%, transparent 100%)'\r\n            }}\r\n        >\r\n            {isReady ? (\r\n                <Virtuoso\r\n                    ref={virtuosoRef}\r\n                    className=\"no-scrollbar\"\r\n                    style={{ height: '100%' }}\r\n                    totalCount={parsedLines.length}\r\n                    data={parsedLines}\r\n                    // Header provides the top spacing to center the first line\r\n                    components={{\r\n                        Header: () => <div style={{ height: '40vh' }} />,\r\n                        Footer: () => <div style={{ height: '40vh' }} />,\r\n                    }}\r\n                    itemContent={(index, line) => (\r\n                        <div\r\n                            className={cn(\r\n                                \"py-3 px-4 transition-all duration-300 leading-relaxed cursor-pointer origin-left will-change-transform backface-visibility-hidden\",\r\n                                index === currentLineIndex\r\n                                    ? \"text-2xl font-bold text-white scale-100 opacity-100\"\r\n                                    : \"text-2xl font-medium text-white scale-90 opacity-40 blur-[0.5px]\"\r\n                            )}\r\n                            style={{ transform: index !== currentLineIndex ? 'scale(0.9)' : 'scale(1)', transformOrigin: 'left center' }}\r\n                            onClick={() => {\r\n                                // Optional: Click to seek could go here\r\n                                const audio = document.querySelector('audio');\r\n                                if (audio) {\r\n                                    audio.currentTime = line.time;\r\n                                }\r\n                            }}\r\n                        >\r\n                            {line.text || 'ΓÖ¬'}\r\n                        </div>\r\n                    )}\r\n                />\r\n            ) : (\r\n                <div className=\"h-full flex items-center justify-center opacity-0 transition-opacity duration-300\">\r\n                    {/* Placeholder waiting for layout */}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\settings\\DangerZone.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\settings\\LibraryPathManager.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nZ:\\Antigravity\\tremors-music\\frontend\\src\\components\\settings\\LibraryPathManager.tsx:31:9\n  29 |\n  30 |     useEffect(() => {\n> 31 |         loadPaths();\n     |         ^^^^^^^^^ Avoid calling setState() directly within an effect\n  32 |     }, [loadPaths]);\n  33 |\n  34 |     const handleAddPath = async () => {","line":31,"column":9,"nodeType":null,"endLine":31,"endColumn":18}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_id' is defined but never used.","line":73,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":32,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Library path manager component with CRUD operations\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { Plus, Trash2, Edit2, Check, X } from 'lucide-react';\r\nimport api from '../../lib/api';\r\nimport { Card } from '../common/Card';\r\nimport { IconButton } from '../common/IconButton';\r\nimport { useConfirm } from '../../stores/confirmStore';\r\n\r\ninterface LibraryPath {\r\n    id: number;\r\n    path: string;\r\n}\r\n\r\nexport function LibraryPathManager() {\r\n    const [paths, setPaths] = useState<LibraryPath[]>([]);\r\n    const [newPath, setNewPath] = useState('');\r\n    const [editingId, setEditingId] = useState<number | null>(null);\r\n    const [editingPath, setEditingPath] = useState('');\r\n    const confirm = useConfirm();\r\n\r\n    const loadPaths = useCallback(async () => {\r\n        try {\r\n            const res = await api.get<LibraryPath[]>('/library/paths');\r\n            setPaths(Array.isArray(res.data) ? res.data : []);\r\n        } catch {\r\n            console.error('Failed to load paths');\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        loadPaths();\r\n    }, [loadPaths]);\r\n\r\n    const handleAddPath = async () => {\r\n        if (!newPath.trim()) return;\r\n        try {\r\n            await api.post('/library/paths', { path: newPath });\r\n            setNewPath('');\r\n            loadPaths();\r\n        } catch {\r\n            alert('Invalid path or server error');\r\n        }\r\n    };\r\n\r\n    const handleRemovePath = async (id: number) => {\r\n        const confirmed = await confirm({\r\n            title: 'Remove Library Path',\r\n            message: 'Remove this folder from your library? Your files will not be deleted.',\r\n            confirmText: 'Remove',\r\n            variant: 'warning',\r\n        });\r\n\r\n        if (!confirmed) return;\r\n        try {\r\n            await api.delete(`/library/paths/${id}`);\r\n            loadPaths();\r\n        } catch {\r\n            console.error('Failed to remove path');\r\n        }\r\n    };\r\n\r\n    const startEditing = (path: LibraryPath) => {\r\n        setEditingId(path.id);\r\n        setEditingPath(path.path);\r\n    };\r\n\r\n    const cancelEditing = () => {\r\n        setEditingId(null);\r\n        setEditingPath('');\r\n    };\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    const saveEdit = async (_id: number) => {\r\n        if (!editingPath.trim()) return;\r\n        // Note: Backend doesn't have edit endpoint yet, would need to add\r\n        // For now, just cancel editing\r\n        cancelEditing();\r\n        // TODO: Implement backend PATCH /library/paths/{id}\r\n    };\r\n\r\n\r\n    return (\r\n        <Card>\r\n            <div className=\"space-y-4\">\r\n                <h4 className=\"text-sm font-semibold text-apple-subtext uppercase tracking-wider\">Music Folders</h4>\r\n\r\n                {/* Path List */}\r\n                <div className=\"space-y-2\">\r\n                    {paths.length === 0 && (\r\n                        <p className=\"text-sm text-apple-subtext italic\">No folders added yet.</p>\r\n                    )}\r\n                    {paths.map(p => (\r\n                        <div\r\n                            key={p.id}\r\n                            className=\"flex items-center justify-between bg-gray-100 dark:bg-white/5 p-3 rounded-lg border border-transparent hover:border-gray-200 dark:hover:border-white/10 transition\"\r\n                        >\r\n                            {editingId === p.id ? (\r\n                                <>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={editingPath}\r\n                                        onChange={(e) => setEditingPath(e.target.value)}\r\n                                        className=\"flex-1 px-2 py-1 text-sm bg-white dark:bg-black/20 border border-gray-300 dark:border-white/20 rounded text-apple-text focus:outline-none focus:ring-2 focus:ring-apple-accent/50\"\r\n                                        autoFocus\r\n                                    />\r\n                                    <div className=\"flex gap-1 ml-2\">\r\n                                        <IconButton\r\n                                            icon={<Check size={16} />}\r\n                                            onClick={() => saveEdit(p.id)}\r\n                                            variant=\"accent\"\r\n                                            size=\"sm\"\r\n                                            tooltip=\"Save\"\r\n                                        />\r\n                                        <IconButton\r\n                                            icon={<X size={16} />}\r\n                                            onClick={cancelEditing}\r\n                                            variant=\"ghost\"\r\n                                            size=\"sm\"\r\n                                            tooltip=\"Cancel\"\r\n                                        />\r\n                                    </div>\r\n                                </>\r\n                            ) : (\r\n                                <>\r\n                                    <span className=\"text-sm font-mono text-apple-text truncate px-2 flex-1\">{p.path}</span>\r\n                                    <div className=\"flex gap-1\">\r\n                                        <IconButton\r\n                                            icon={<Edit2 size={16} />}\r\n                                            onClick={() => startEditing(p)}\r\n                                            variant=\"ghost\"\r\n                                            size=\"sm\"\r\n                                            tooltip=\"Edit path\"\r\n                                        />\r\n                                        <IconButton\r\n                                            icon={<Trash2 size={16} />}\r\n                                            onClick={() => handleRemovePath(p.id)}\r\n                                            variant=\"ghost\"\r\n                                            size=\"sm\"\r\n                                            tooltip=\"Remove path\"\r\n                                            className=\"hover:text-red-500\"\r\n                                        />\r\n                                    </div>\r\n                                </>\r\n                            )}\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Add New Path */}\r\n                <div className=\"flex gap-2\">\r\n                    <input\r\n                        type=\"text\"\r\n                        value={newPath}\r\n                        onChange={(e) => setNewPath(e.target.value)}\r\n                        onKeyDown={(e) => e.key === 'Enter' && handleAddPath()}\r\n                        placeholder=\"e.g. D:/Music or /home/user/Music\"\r\n                        className=\"flex-1 p-3 text-sm rounded-lg border border-gray-200 dark:border-white/10 bg-white dark:bg-black/20 text-apple-text focus:outline-none focus:ring-2 focus:ring-apple-accent/50\"\r\n                    />\r\n                    <IconButton\r\n                        icon={<Plus size={20} />}\r\n                        onClick={handleAddPath}\r\n                        variant=\"default\"\r\n                        tooltip=\"Add folder\"\r\n                    />\r\n                </div>\r\n            </div>\r\n        </Card>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\settings\\ScannerControl.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nZ:\\Antigravity\\tremors-music\\frontend\\src\\components\\settings\\ScannerControl.tsx:106:9\n  104 |\n  105 |     useEffect(() => {\n> 106 |         checkScanStatus();\n      |         ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  107 |         return () => {\n  108 |             if (pollInterval.current) {\n  109 |                 clearInterval(pollInterval.current);","line":106,"column":9,"nodeType":null,"endLine":106,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Scanner control with progress tracking and error details\r\nimport { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { useQueryClient } from '@tanstack/react-query';\r\nimport { RefreshCw, StopCircle, CheckCircle, AlertCircle, Clock, ChevronDown, ChevronUp } from 'lucide-react';\r\nimport api from '../../lib/api';\r\nimport { Card } from '../common/Card';\r\nimport { Button } from '../common/Button';\r\n\r\ninterface ErrorDetail {\r\n    file_path: string;\r\n    error_message: string;\r\n    timestamp: string;\r\n}\r\n\r\ninterface LastScanResult {\r\n    files_processed: number;\r\n    songs_added: number;\r\n    errors: number;\r\n    duration: number;\r\n    completed_at: string;\r\n    error_details: ErrorDetail[];\r\n}\r\n\r\ninterface ScanProgress {\r\n    is_scanning: boolean;\r\n    files_processed: number;\r\n    songs_added: number;\r\n    errors: number;\r\n    current_file: string;\r\n    start_time: number | null;\r\n    error_details: ErrorDetail[];\r\n    last_scan_result: LastScanResult | null;\r\n}\r\n\r\nexport function ScannerControl() {\r\n    const queryClient = useQueryClient();\r\n    const [isScanning, setIsScanning] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [showErrors, setShowErrors] = useState(false);\r\n    const [elapsedTime, setElapsedTime] = useState('0s');\r\n    const [progress, setProgress] = useState<ScanProgress>({\r\n        is_scanning: false,\r\n        files_processed: 0,\r\n        songs_added: 0,\r\n        errors: 0,\r\n        current_file: '',\r\n        start_time: null,\r\n        error_details: [],\r\n        last_scan_result: null\r\n    });\r\n    const pollInterval = useRef<ReturnType<typeof setInterval> | null>(null);\r\n    const timeInterval = useRef<ReturnType<typeof setInterval> | null>(null);\r\n\r\n    const stopPolling = useCallback(() => {\r\n        if (pollInterval.current) {\r\n            clearInterval(pollInterval.current);\r\n            pollInterval.current = null;\r\n\r\n            // Invalidate all library-related caches so new data appears\r\n            queryClient.invalidateQueries({ queryKey: ['songs'] });\r\n            queryClient.invalidateQueries({ queryKey: ['albums'] });\r\n            queryClient.invalidateQueries({ queryKey: ['albums-all'] });\r\n            queryClient.invalidateQueries({ queryKey: ['artists'] });\r\n            queryClient.invalidateQueries({ queryKey: ['genres'] });\r\n            queryClient.invalidateQueries({ queryKey: ['smart-playlist'] });\r\n        }\r\n        if (timeInterval.current) {\r\n            clearInterval(timeInterval.current);\r\n            timeInterval.current = null;\r\n        }\r\n    }, [queryClient]);\r\n\r\n    const checkScanStatus = useCallback(async () => {\r\n        try {\r\n            const res = await api.get<ScanProgress>('/library/scan/status');\r\n            const data = res.data;\r\n            if (!data) return; // Guard against null/undefined response\r\n\r\n            // Ensure error_details is always an array\r\n            const safeData: ScanProgress = {\r\n                ...data,\r\n                error_details: Array.isArray(data.error_details) ? data.error_details : [],\r\n                last_scan_result: data.last_scan_result ? {\r\n                    ...data.last_scan_result,\r\n                    error_details: Array.isArray(data.last_scan_result.error_details)\r\n                        ? data.last_scan_result.error_details\r\n                        : []\r\n                } : null\r\n            };\r\n\r\n            setProgress(safeData);\r\n            setIsScanning(safeData.is_scanning);\r\n            setError(null);\r\n\r\n            if (!safeData.is_scanning && pollInterval.current) {\r\n                stopPolling();\r\n            }\r\n        } catch (e: unknown) {\r\n            console.error('Failed to get scan status:', e);\r\n            const errorMessage = e instanceof Error ? e.message : 'Failed to connect to scanner';\r\n            setError(errorMessage);\r\n        }\r\n    }, [stopPolling]);\r\n\r\n    useEffect(() => {\r\n        checkScanStatus();\r\n        return () => {\r\n            if (pollInterval.current) {\r\n                clearInterval(pollInterval.current);\r\n            }\r\n            if (timeInterval.current) {\r\n                clearInterval(timeInterval.current);\r\n            }\r\n        };\r\n    }, [checkScanStatus]);\r\n\r\n    const startPolling = useCallback(() => {\r\n        pollInterval.current = setInterval(checkScanStatus, 500);\r\n        // Update elapsed time every second\r\n        timeInterval.current = setInterval(() => {\r\n            setProgress(prev => {\r\n                if (!prev.start_time) return prev;\r\n                const elapsed = Math.floor((Date.now() - prev.start_time) / 1000);\r\n                const mins = Math.floor(elapsed / 60);\r\n                const secs = elapsed % 60;\r\n                setElapsedTime(mins > 0 ? `${mins}m ${secs}s` : `${secs}s`);\r\n                return prev;\r\n            });\r\n        }, 1000);\r\n    }, [checkScanStatus]);\r\n\r\n    const handleStartScan = async () => {\r\n        try {\r\n            setError(null);\r\n            setIsScanning(true);\r\n            setElapsedTime('0s');\r\n            await api.post('/library/scan');\r\n            startPolling();\r\n        } catch (e: unknown) {\r\n            console.error('Failed to start scan:', e);\r\n            const errorMessage = e instanceof Error ? e.message : 'Failed to start scan';\r\n            setError(errorMessage);\r\n            setIsScanning(false);\r\n        }\r\n    };\r\n\r\n    const handleStopScan = async () => {\r\n        try {\r\n            stopPolling();\r\n            setIsScanning(false);\r\n        } catch (e) {\r\n            console.error('Failed to stop scan:', e);\r\n        }\r\n    };\r\n\r\n    const getElapsedTime = () => elapsedTime;\r\n\r\n    const formatDuration = (seconds: number) => {\r\n        const mins = Math.floor(seconds / 60);\r\n        const secs = Math.floor(seconds % 60);\r\n        return mins > 0 ? `${mins}m ${secs}s` : `${secs}s`;\r\n    };\r\n\r\n    const formatDate = (isoString: string) => {\r\n        const date = new Date(isoString);\r\n        return date.toLocaleString();\r\n    };\r\n\r\n    const getFileName = (path: string) => {\r\n        return path.split(/[/\\\\]/).pop() || path;\r\n    };\r\n\r\n    return (\r\n        <Card className=\"mt-4\">\r\n            <div className=\"space-y-4\">\r\n                <h4 className=\"text-sm font-semibold text-apple-subtext uppercase tracking-wider\">Library Scanner</h4>\r\n\r\n                {error && (\r\n                    <div className=\"flex items-start gap-2 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\r\n                        <AlertCircle size={18} className=\"text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5\" />\r\n                        <div className=\"flex-1\">\r\n                            <div className=\"text-sm font-medium text-red-700 dark:text-red-300\">Scan Error</div>\r\n                            <div className=\"text-xs text-red-600 dark:text-red-400 mt-1\">{error}</div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {!isScanning ? (\r\n                    <Button onClick={handleStartScan} variant=\"primary\" className=\"w-full\" disabled={isScanning}>\r\n                        <RefreshCw size={18} />\r\n                        Scan All Folders\r\n                    </Button>\r\n                ) : (\r\n                    <Button onClick={handleStopScan} variant=\"danger\" className=\"w-full\">\r\n                        <StopCircle size={18} />\r\n                        Stop Scanning\r\n                    </Button>\r\n                )}\r\n\r\n                {isScanning && (\r\n                    <div className=\"space-y-3 p-4 bg-gray-50 dark:bg-black/20 rounded-lg border border-gray-200 dark:border-white/10\">\r\n                        <div className=\"space-y-1\">\r\n                            <div className=\"flex justify-between text-xs text-apple-subtext\">\r\n                                <span>Scanning...</span>\r\n                                <span>{getElapsedTime()}</span>\r\n                            </div>\r\n                            <div className=\"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\r\n                                <div className=\"h-full bg-apple-accent transition-all duration-300 rounded-full\" style={{ width: '100%' }}>\r\n                                    <div className=\"h-full w-full bg-gradient-to-r from-transparent via-white/30 to-transparent animate-pulse\" />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {progress.current_file && (\r\n                            <div className=\"text-xs text-apple-subtext truncate\">\r\n                                ≡ƒôü {getFileName(progress.current_file)}\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-3 gap-3 pt-2 border-t border-gray-200 dark:border-white/10\">\r\n                            <div className=\"text-center\">\r\n                                <div className=\"text-lg font-semibold text-apple-text\">{progress.files_processed}</div>\r\n                                <div className=\"text-xs text-apple-subtext\">Files</div>\r\n                            </div>\r\n                            <div className=\"text-center\">\r\n                                <div className=\"text-lg font-semibold text-green-500\">{progress.songs_added}</div>\r\n                                <div className=\"text-xs text-apple-subtext\">Added</div>\r\n                            </div>\r\n                            <div className=\"text-center\">\r\n                                <div className=\"text-lg font-semibold text-red-500\">{progress.errors}</div>\r\n                                <div className=\"text-xs text-apple-subtext\">Errors</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Live error list during scan */}\r\n                        {progress.error_details.length > 0 && (\r\n                            <div className=\"pt-2 border-t border-gray-200 dark:border-white/10\">\r\n                                <button\r\n                                    onClick={() => setShowErrors(!showErrors)}\r\n                                    className=\"flex items-center justify-between w-full text-xs font-medium text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 transition\"\r\n                                >\r\n                                    <span>{progress.error_details.length} file{progress.error_details.length !== 1 ? 's' : ''} failed</span>\r\n                                    {showErrors ? <ChevronUp size={14} /> : <ChevronDown size={14} />}\r\n                                </button>\r\n                                {showErrors && (\r\n                                    <div className=\"mt-2 max-h-40 overflow-y-auto space-y-1\">\r\n                                        {progress.error_details.map((err, idx) => (\r\n                                            <div key={idx} className=\"text-xs p-2 bg-red-50 dark:bg-red-900/10 rounded border border-red-200 dark:border-red-800\">\r\n                                                <div className=\"font-medium text-red-700 dark:text-red-300 truncate\" title={err.file_path}>\r\n                                                    {getFileName(err.file_path)}\r\n                                                </div>\r\n                                                <div className=\"text-red-600 dark:text-red-400 mt-0.5\">{err.error_message}</div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                {!isScanning && progress.last_scan_result && (\r\n                    <div className=\"space-y-2 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <CheckCircle size={18} className=\"text-blue-600 dark:text-blue-400\" />\r\n                                <span className=\"text-sm font-semibold text-blue-700 dark:text-blue-300\">Last Scan Complete</span>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-1 text-xs text-blue-600 dark:text-blue-400\">\r\n                                <Clock size={12} />\r\n                                {formatDuration(progress.last_scan_result.duration)}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-3 gap-2 mt-2\">\r\n                            <div className=\"text-center p-2 bg-white/50 dark:bg-black/20 rounded\">\r\n                                <div className=\"text-sm font-bold text-blue-700 dark:text-blue-300\">{progress.last_scan_result.files_processed}</div>\r\n                                <div className=\"text-xs text-blue-600 dark:text-blue-400\">Files</div>\r\n                            </div>\r\n                            <div className=\"text-center p-2 bg-white/50 dark:bg-black/20 rounded\">\r\n                                <div className=\"text-sm font-bold text-green-600 dark:text-green-400\">{progress.last_scan_result.songs_added}</div>\r\n                                <div className=\"text-xs text-blue-600 dark:text-blue-400\">Added</div>\r\n                            </div>\r\n                            <div className=\"text-center p-2 bg-white/50 dark:bg-black/20 rounded\">\r\n                                <div className=\"text-sm font-bold text-red-600 dark:text-red-400\">{progress.last_scan_result.errors}</div>\r\n                                <div className=\"text-xs text-blue-600 dark:text-blue-400\">Errors</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"text-xs text-blue-600 dark:text-blue-400 mt-2\">\r\n                            Completed: {formatDate(progress.last_scan_result.completed_at)}\r\n                        </div>\r\n\r\n                        {/* Error details from last scan */}\r\n                        {progress.last_scan_result.error_details && progress.last_scan_result.error_details.length > 0 && (\r\n                            <div className=\"mt-3 pt-3 border-t border-blue-200 dark:border-blue-700\">\r\n                                <button\r\n                                    onClick={() => setShowErrors(!showErrors)}\r\n                                    className=\"flex items-center justify-between w-full text-xs font-medium text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 transition\"\r\n                                >\r\n                                    <span>View {progress.last_scan_result.error_details.length} failed file{progress.last_scan_result.error_details.length !== 1 ? 's' : ''}</span>\r\n                                    {showErrors ? <ChevronUp size={14} /> : <ChevronDown size={14} />}\r\n                                </button>\r\n                                {showErrors && (\r\n                                    <div className=\"mt-2 max-h-60 overflow-y-auto space-y-1\">\r\n                                        {progress.last_scan_result.error_details.map((err, idx) => (\r\n                                            <div key={idx} className=\"text-xs p-2 bg-red-50 dark:bg-red-900/10 rounded border border-red-200 dark:border-red-800\">\r\n                                                <div className=\"font-medium text-red-700 dark:text-red-300 truncate\" title={err.file_path}>\r\n                                                    ≡ƒôä {getFileName(err.file_path)}\r\n                                                </div>\r\n                                                <div className=\"text-red-600 dark:text-red-400 mt-0.5\">{err.error_message}</div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </Card>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\components\\settings\\ThemeSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\hooks\\useKeyboardShortcuts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\lib\\animations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\lib\\api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\pages\\AlbumDetail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\pages\\AlbumsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\pages\\AllPlaylistsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\pages\\ArtistDetail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\pages\\ArtistsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\pages\\GenreDetail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\pages\\GenresPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\pages\\LibraryPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\pages\\PlaylistDetail.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nZ:\\Antigravity\\tremors-music\\frontend\\src\\pages\\PlaylistDetail.tsx:160:7\n  158 |   useEffect(() => {\n  159 |     if (serverSongs) {\n> 160 |       setItems(serverSongs.map((s, i) => ({ ...s, uniqueId: `${s.id}-${i}` })));\n      |       ^^^^^^^^ Avoid calling setState() directly within an effect\n  161 |     }\n  162 |   }, [serverSongs]);\n  163 |","line":160,"column":7,"nodeType":null,"endLine":160,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_uniqueId' is assigned a value but never used.","line":206,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":206,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_uid' is defined but never used.","line":208,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":208,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_uid' is defined but never used.","line":215,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":215,"endColumn":48},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_uid' is defined but never used.","line":224,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":224,"endColumn":48}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { getPlaylistSongs, getPlaylists, deletePlaylist, getCoverUrl, removeSongFromPlaylist, reorderPlaylist } from '../lib/api';\r\nimport { usePlayerStore } from '../stores/playerStore';\r\nimport { useThemeStore } from '../stores/themeStore';\r\nimport { useToastStore } from '../stores/toastStore';\r\nimport { formatTime, cn, shuffleArray } from '../lib/utils';\r\nimport { Play, Trash2, Music, ListMusic, Shuffle, GripVertical, X } from 'lucide-react';\r\nimport { SongListSkeleton } from '../components/Skeletons';\r\nimport { useConfirm } from '../stores/confirmStore';\r\nimport { Song } from '../types';\r\nimport { SongContextMenu } from '../components/ContextMenu';\r\n\r\nimport {\r\n  DndContext,\r\n  closestCenter,\r\n  KeyboardSensor,\r\n  PointerSensor,\r\n  useSensor,\r\n  useSensors,\r\n  DragEndEvent\r\n} from '@dnd-kit/core';\r\nimport {\r\n  arrayMove,\r\n  SortableContext,\r\n  sortableKeyboardCoordinates,\r\n  verticalListSortingStrategy,\r\n  useSortable\r\n} from '@dnd-kit/sortable';\r\nimport { CSS } from '@dnd-kit/utilities';\r\n\r\n// Wrapper type for DnD stability (handles duplicates)\r\ninterface PlaylistItem extends Song {\r\n  uniqueId: string;\r\n}\r\n\r\nfunction SortableRow({\r\n  item,\r\n  index,\r\n  isActive,\r\n  showArt,\r\n  onPlay,\r\n  onRemove\r\n}: {\r\n  item: PlaylistItem;\r\n  index: number;\r\n  isActive: boolean;\r\n  showArt: boolean;\r\n  onPlay: () => void;\r\n  onRemove: (e: React.MouseEvent) => void;\r\n}) {\r\n  const {\r\n    attributes,\r\n    listeners,\r\n    setNodeRef,\r\n    transform,\r\n    transition,\r\n    isDragging\r\n  } = useSortable({ id: item.uniqueId });\r\n\r\n  const style = {\r\n    transform: CSS.Transform.toString(transform),\r\n    transition,\r\n    zIndex: isDragging ? 10 : 1,\r\n    opacity: isDragging ? 0.8 : 1,\r\n  };\r\n\r\n  return (\r\n    <div\r\n      ref={setNodeRef}\r\n      style={style}\r\n      className={cn(\r\n        \"flex items-center px-4 py-2 hover:bg-gray-200/50 dark:hover:bg-white/5 group transition-colors border-b border-gray-100 dark:border-white/5 h-14 bg-apple-gray\",\r\n        isActive && \"bg-gray-200 dark:bg-white/10\"\r\n      )}\r\n    >\r\n      {/* Drag Handle */}\r\n      <div\r\n        {...attributes}\r\n        {...listeners}\r\n        className=\"w-8 flex items-center justify-center cursor-grab active:cursor-grabbing text-apple-subtext hover:text-apple-text mr-2 touch-none\"\r\n      >\r\n        <GripVertical size={16} />\r\n      </div>\r\n\r\n      {/* Index / Play */}\r\n      <div\r\n        className=\"w-8 text-center text-sm text-apple-subtext relative flex-shrink-0 cursor-pointer\"\r\n        onClick={onPlay}\r\n      >\r\n        <span className={cn(\"group-hover:hidden\", isActive && \"text-apple-accent font-bold\")}>{index + 1}</span>\r\n        <span className=\"hidden group-hover:flex items-center justify-center absolute inset-0\">\r\n          <Play size={12} fill=\"currentColor\" className={isActive ? \"text-apple-accent\" : \"text-apple-text\"} />\r\n        </span>\r\n      </div>\r\n\r\n      {showArt && (\r\n        <div className=\"w-12 flex-shrink-0 flex justify-center ml-2 cursor-pointer\" onClick={onPlay}>\r\n          <div className=\"w-9 h-9 rounded overflow-hidden bg-gray-200 dark:bg-white/10 relative border border-black/5\">\r\n            {item.album_id ? (\r\n              <img src={getCoverUrl(item.album_id)} className=\"w-full h-full object-cover\" loading=\"lazy\" />\r\n            ) : <Music size={14} className=\"m-auto text-gray-400\" />}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"flex-1 min-w-0 pl-4 pr-4 cursor-pointer\" onClick={onPlay}>\r\n        <div className={cn(\"font-medium truncate text-sm\", isActive ? \"text-apple-accent\" : \"text-apple-text\")}>\r\n          {item.title}\r\n        </div>\r\n        <div className=\"md:hidden text-xs text-apple-subtext truncate\">{item.artist}</div>\r\n      </div>\r\n\r\n      <div className=\"w-1/3 hidden md:block text-sm text-apple-subtext truncate cursor-pointer\" onClick={onPlay}>{item.artist}</div>\r\n      <div className=\"w-16 text-right text-sm text-apple-subtext tabular-nums mr-4 cursor-pointer\" onClick={onPlay}>{formatTime(item.duration)}</div>\r\n\r\n      {/* Actions */}\r\n      <div className=\"flex items-center gap-1\">\r\n        <SongContextMenu song={item} onAddToPlaylist={() => { }} />\r\n        <button\r\n          onClick={onRemove}\r\n          className=\"p-1.5 text-apple-subtext hover:text-red-500 hover:bg-black/5 dark:hover:bg-white/10 rounded transition\"\r\n          title=\"Remove from playlist\"\r\n        >\r\n          <X size={16} />\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function PlaylistDetail() {\r\n  const { id } = useParams<{ id: string }>();\r\n  const navigate = useNavigate();\r\n  const queryClient = useQueryClient();\r\n  const { addToast } = useToastStore();\r\n\r\n  const { playSong, setQueue, currentSong } = usePlayerStore();\r\n  const { showSongListArt } = useThemeStore();\r\n  const confirm = useConfirm();\r\n\r\n  // 1. Get Playlist Metadata\r\n  const { data: playlists } = useQuery({ queryKey: ['playlists'], queryFn: getPlaylists });\r\n  const playlistInfo = playlists?.find(p => p.id === Number(id));\r\n\r\n  // 2. Get Songs\r\n  const { data: serverSongs, isLoading } = useQuery({\r\n    queryKey: ['playlist-songs', id],\r\n    queryFn: () => getPlaylistSongs(id!),\r\n    enabled: !!id,\r\n  });\r\n\r\n  // Local state for optimistic DnD\r\n  const [items, setItems] = useState<PlaylistItem[]>([]);\r\n\r\n  // Sync server data to local state\r\n  useEffect(() => {\r\n    if (serverSongs) {\r\n      setItems(serverSongs.map((s, i) => ({ ...s, uniqueId: `${s.id}-${i}` })));\r\n    }\r\n  }, [serverSongs]);\r\n\r\n  const sensors = useSensors(\r\n    useSensor(PointerSensor),\r\n    useSensor(KeyboardSensor, { coordinateGetter: sortableKeyboardCoordinates })\r\n  );\r\n\r\n  const handleDragEnd = async (event: DragEndEvent) => {\r\n    const { active, over } = event;\r\n\r\n    if (over && active.id !== over.id) {\r\n      setItems((items) => {\r\n        const oldIndex = items.findIndex((i) => i.uniqueId === active.id);\r\n        const newIndex = items.findIndex((i) => i.uniqueId === over.id);\r\n        const newItems = arrayMove(items, oldIndex, newIndex);\r\n\r\n        // Optimistic update\r\n        reorderPlaylist(Number(id), newItems.map(i => i.id)).catch(() => {\r\n          addToast('Failed to save order', 'error');\r\n          queryClient.invalidateQueries({ queryKey: ['playlist-songs', id] });\r\n        });\r\n\r\n        return newItems;\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleRemoveSong = async (e: React.MouseEvent, songId: number, itemUniqueId: string) => {\r\n    e.stopPropagation();\r\n\r\n    // Optimistic removal\r\n    setItems(prev => prev.filter(i => i.uniqueId !== itemUniqueId));\r\n\r\n    try {\r\n      await removeSongFromPlaylist(Number(id), songId);\r\n      // addToast('Song removed'); // Optional toast, maybe too noisy\r\n    } catch {\r\n      addToast('Failed to remove song', 'error');\r\n      queryClient.invalidateQueries({ queryKey: ['playlist-songs', id] });\r\n    }\r\n  };\r\n\r\n  const handlePlay = (song: PlaylistItem) => {\r\n    // Strip uniqueId for player\r\n    const { uniqueId: _uniqueId, ...rawSong } = song;\r\n    // Set queue to current visible order\r\n    const queue = items.map(({ uniqueId: _uid, ...s }) => s);\r\n    setQueue(queue);\r\n    playSong(rawSong);\r\n  };\r\n\r\n  const handlePlayAll = () => {\r\n    if (items.length > 0) {\r\n      const queue = items.map(({ uniqueId: _uid, ...s }) => s);\r\n      setQueue(queue);\r\n      usePlayerStore.setState({ isShuffle: false });\r\n      playSong(queue[0]);\r\n    }\r\n  };\r\n\r\n  const handleShuffleAll = () => {\r\n    if (items.length > 0) {\r\n      const queue = items.map(({ uniqueId: _uid, ...s }) => s);\r\n      const shuffled = shuffleArray(queue);\r\n      usePlayerStore.setState({ isShuffle: true, queue: shuffled, originalQueue: queue });\r\n      playSong(shuffled[0]);\r\n    }\r\n  };\r\n\r\n  const handleDeletePlaylist = async () => {\r\n    const confirmed = await confirm({\r\n      title: 'Delete Playlist',\r\n      message: `Are you sure you want to delete \"${playlistInfo?.name}\"?`,\r\n      confirmText: 'Delete',\r\n      variant: 'danger',\r\n    });\r\n\r\n    if (confirmed) {\r\n      await deletePlaylist(Number(id));\r\n      queryClient.invalidateQueries({ queryKey: ['playlists'] });\r\n      addToast('Playlist deleted');\r\n      navigate('/');\r\n    }\r\n  };\r\n\r\n  if (!playlistInfo) return <div className=\"p-8 text-apple-subtext\">Playlist not found</div>;\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col bg-apple-gray overflow-hidden\">\r\n      {/* Header Section */}\r\n      <div className=\"p-8 pb-6 flex items-end gap-6 border-b border-gray-200 dark:border-white/10 flex-shrink-0 bg-apple-gray z-10\">\r\n        <div className=\"w-32 h-32 sm:w-40 sm:h-40 bg-gradient-to-br from-pink-500 to-orange-400 rounded-lg shadow-xl flex items-center justify-center text-white\">\r\n          {items.length > 0 && items[0].album_id ? (\r\n            <img src={getCoverUrl(items[0].album_id)} className=\"w-full h-full object-cover rounded-lg\" />\r\n          ) : (\r\n            <ListMusic size={48} />\r\n          )}\r\n        </div>\r\n        <div className=\"flex-1 mb-1\">\r\n          <h5 className=\"text-xs font-bold text-apple-accent uppercase tracking-widest mb-1\">Playlist</h5>\r\n          <h1 className=\"text-3xl sm:text-5xl font-bold text-apple-text mb-3\">{playlistInfo.name}</h1>\r\n          <div className=\"flex items-center gap-3 text-apple-subtext text-sm font-medium\">\r\n            <span>{items.length} Songs</span>\r\n            {items.length > 0 && (\r\n              <div className=\"flex gap-2\">\r\n                <button onClick={handlePlayAll} className=\"px-4 py-1.5 bg-apple-accent text-white rounded-full font-semibold flex items-center gap-2 hover:opacity-90 transition text-sm shadow-lg\">\r\n                  <Play size={14} fill=\"currentColor\" /> Play\r\n                </button>\r\n                <button onClick={handleShuffleAll} className=\"px-4 py-1.5 bg-gray-200 dark:bg-white/10 text-apple-text rounded-full font-semibold flex items-center gap-2 hover:bg-gray-300 dark:hover:bg-white/20 transition text-sm\">\r\n                  <Shuffle size={14} /> Shuffle\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        <button onClick={handleDeletePlaylist} className=\"p-2 text-apple-subtext hover:text-red-500 transition mb-2 bg-gray-100 dark:bg-white/5 rounded-lg\" title=\"Delete Playlist\">\r\n          <Trash2 size={20} />\r\n        </button>\r\n      </div>\r\n\r\n      {/* Song List Table */}\r\n      <div className=\"flex-1 overflow-y-auto pb-32\">\r\n        {isLoading ? (\r\n          <SongListSkeleton count={8} />\r\n        ) : items.length === 0 ? (\r\n          <div className=\"p-12 text-center text-apple-subtext\">This playlist is empty. Add songs from the Library.</div>\r\n        ) : (\r\n          <div className=\"w-full\">\r\n            <div className=\"flex items-center px-4 py-2 text-xs font-semibold text-apple-subtext uppercase tracking-wider sticky top-0 bg-apple-gray/95 backdrop-blur z-20 border-b border-gray-200 dark:border-white/5\">\r\n              <div className=\"w-8 ml-2\"></div>{/* Grip placeholder */}\r\n              <div className=\"w-8 text-center\">#</div>\r\n              {showSongListArt && <div className=\"w-12 ml-2\"></div>}\r\n              <div className=\"flex-1 pl-4\">Title</div>\r\n              <div className=\"w-1/3 hidden md:block\">Artist</div>\r\n              <div className=\"w-16 text-right mr-4\">Time</div>\r\n              <div className=\"w-6\"></div>{/* Delete placeholder */}\r\n            </div>\r\n\r\n            <DndContext\r\n              sensors={sensors}\r\n              collisionDetection={closestCenter}\r\n              onDragEnd={handleDragEnd}\r\n            >\r\n              <SortableContext\r\n                items={items.map(i => i.uniqueId)}\r\n                strategy={verticalListSortingStrategy}\r\n              >\r\n                {items.map((song, index) => (\r\n                  <SortableRow\r\n                    key={song.uniqueId}\r\n                    item={song}\r\n                    index={index}\r\n                    isActive={currentSong?.id === song.id}\r\n                    showArt={showSongListArt}\r\n                    onPlay={() => handlePlay(song)}\r\n                    onRemove={(e) => handleRemoveSong(e, song.id, song.uniqueId)}\r\n                  />\r\n                ))}\r\n              </SortableContext>\r\n            </DndContext>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\pages\\SearchPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\pages\\SettingsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\pages\\SmartPlaylistDetail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\stores\\confirmStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\stores\\filterStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\stores\\playerStore.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_error' is defined but never used.","line":171,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":171,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport { persist, createJSONStorage } from 'zustand/middleware';\r\nimport { Song } from '../types';\r\nimport { getSong } from '../lib/api';\r\n\r\ntype RepeatMode = 'off' | 'all' | 'one';\r\n\r\ninterface PlayerState {\r\n  isPlaying: boolean;\r\n  currentSong: Song | null;\r\n  volume: number;\r\n  queue: Song[];\r\n  originalQueue: Song[];\r\n  currentIndex: number;\r\n  repeatMode: RepeatMode;\r\n  isShuffle: boolean;\r\n\r\n  playSong: (song: Song) => void;\r\n  togglePlay: () => void;\r\n  setIsPlaying: (isPlaying: boolean) => void;\r\n  setVolume: (val: number) => void;\r\n  setQueue: (songs: Song[]) => void;\r\n  playNext: () => void;\r\n  playPrev: () => void;\r\n  toggleShuffle: () => void;\r\n  toggleRepeat: () => void;\r\n  reorderQueue: (oldIndex: number, newIndex: number) => void;\r\n  removeFromQueue: (index: number) => void;\r\n  addToQueue: (song: Song) => void;\r\n  clearQueue: () => void;\r\n  validateState: () => Promise<void>;\r\n}\r\n\r\nexport const usePlayerStore = create<PlayerState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      isPlaying: false,\r\n      currentSong: null,\r\n      volume: 1,\r\n      queue: [],\r\n      originalQueue: [],\r\n      currentIndex: -1,\r\n      repeatMode: 'off',\r\n      isShuffle: false,\r\n\r\n      playSong: (song) => set({ currentSong: song, isPlaying: true }),\r\n\r\n      togglePlay: () => set((state) => ({ isPlaying: !state.isPlaying })),\r\n\r\n      setIsPlaying: (isPlaying) => set({ isPlaying }),\r\n\r\n      setVolume: (val) => set({ volume: val }),\r\n\r\n      setQueue: (songs) => set({ queue: songs, originalQueue: songs }),\r\n\r\n      toggleShuffle: () => {\r\n        const { isShuffle, originalQueue, currentSong } = get();\r\n        if (!isShuffle) {\r\n          const newQueue = [...originalQueue];\r\n          // Fisher-Yates Shuffle\r\n          for (let i = newQueue.length - 1; i > 0; i--) {\r\n            const j = Math.floor(Math.random() * (i + 1));\r\n            [newQueue[i], newQueue[j]] = [newQueue[j], newQueue[i]];\r\n          }\r\n          // Keep current song first\r\n          if (currentSong) {\r\n            const idx = newQueue.findIndex(s => s.id === currentSong.id);\r\n            if (idx > -1) {\r\n              newQueue.splice(idx, 1);\r\n              newQueue.unshift(currentSong);\r\n            }\r\n          }\r\n          set({ isShuffle: true, queue: newQueue });\r\n        } else {\r\n          set({ isShuffle: false, queue: originalQueue });\r\n        }\r\n      },\r\n\r\n      toggleRepeat: () => {\r\n        const modes: RepeatMode[] = ['off', 'all', 'one'];\r\n        const next = modes[(modes.indexOf(get().repeatMode) + 1) % modes.length];\r\n        set({ repeatMode: next });\r\n      },\r\n\r\n      playNext: () => {\r\n        const { queue, currentSong, repeatMode } = get();\r\n        if (!currentSong) return;\r\n\r\n        if (repeatMode === 'one') {\r\n          set({ isPlaying: true });\r\n          const audio = document.querySelector('audio');\r\n          if (audio) { audio.currentTime = 0; audio.play(); }\r\n          return;\r\n        }\r\n\r\n        const idx = queue.findIndex(s => s.id === currentSong.id);\r\n        if (idx < queue.length - 1) {\r\n          set({ currentSong: queue[idx + 1], isPlaying: true });\r\n        } else if (repeatMode === 'all') {\r\n          set({ currentSong: queue[0], isPlaying: true });\r\n        } else {\r\n          set({ isPlaying: false });\r\n        }\r\n      },\r\n\r\n      playPrev: () => {\r\n        const { queue, currentSong } = get();\r\n        if (!currentSong) return;\r\n        const idx = queue.findIndex(s => s.id === currentSong.id);\r\n        if (idx > 0) {\r\n          set({ currentSong: queue[idx - 1], isPlaying: true });\r\n        } else {\r\n          // If at start of list, restart song\r\n          const audio = document.querySelector('audio');\r\n          if (audio) audio.currentTime = 0;\r\n        }\r\n      },\r\n\r\n      // Queue management actions\r\n      reorderQueue: (oldIndex: number, newIndex: number) => {\r\n        const { queue, currentSong } = get();\r\n        const newQueue = [...queue];\r\n        const [removed] = newQueue.splice(oldIndex, 1);\r\n        newQueue.splice(newIndex, 0, removed);\r\n\r\n        // Update current index if needed\r\n        const newCurrentIndex = newQueue.findIndex(s => s.id === currentSong?.id);\r\n\r\n        set({ queue: newQueue, currentIndex: newCurrentIndex });\r\n      },\r\n\r\n      removeFromQueue: (index: number) => {\r\n        const { queue, currentSong } = get();\r\n        const newQueue = queue.filter((_, i) => i !== index);\r\n\r\n        // Update current index if needed\r\n        const newCurrentIndex = newQueue.findIndex(s => s.id === currentSong?.id);\r\n\r\n        set({ queue: newQueue, currentIndex: newCurrentIndex });\r\n      },\r\n\r\n      addToQueue: (song: Song) => {\r\n        const { queue, originalQueue, currentSong } = get();\r\n        const currentIdx = queue.findIndex(s => s.id === currentSong?.id);\r\n\r\n        // Insert after current song, or at end if no current song\r\n        const newQueue = [...queue];\r\n        const newOriginalQueue = [...originalQueue];\r\n        if (currentIdx >= 0) {\r\n          newQueue.splice(currentIdx + 1, 0, song);\r\n        } else {\r\n          newQueue.push(song);\r\n        }\r\n        // Also add to originalQueue to keep them in sync\r\n        newOriginalQueue.push(song);\r\n\r\n        set({ queue: newQueue, originalQueue: newOriginalQueue });\r\n      },\r\n\r\n      clearQueue: () => {\r\n        set({ queue: [], originalQueue: [], currentIndex: -1, currentSong: null, isPlaying: false });\r\n      },\r\n\r\n      validateState: async () => {\r\n        const { currentSong } = get();\r\n        if (!currentSong) return;\r\n\r\n        try {\r\n          // Check if the current song still exists in the backend\r\n          await getSong(currentSong.id);\r\n        } catch (_error) {\r\n          console.warn('Current song not found in backend (likely db reset). Clearing player state.');\r\n          set({\r\n            queue: [],\r\n            originalQueue: [],\r\n            currentIndex: -1,\r\n            currentSong: null,\r\n            isPlaying: false\r\n          });\r\n        }\r\n      },\r\n    }),\r\n    {\r\n      name: 'tremors-player-storage',\r\n      storage: createJSONStorage(() => localStorage),\r\n      partialize: (state) => ({\r\n        currentSong: state.currentSong,\r\n        volume: state.volume,\r\n        queue: state.queue,\r\n        originalQueue: state.originalQueue,\r\n        repeatMode: state.repeatMode,\r\n        isShuffle: state.isShuffle,\r\n      }),\r\n    }\r\n  )\r\n);","usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\stores\\themeStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\stores\\toastStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"Z:\\Antigravity\\tremors-music\\frontend\\src\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
